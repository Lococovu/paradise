on load:
  wait 10 seconds
  # –ê–≤—Ç–æ—Ä–∏–∑–æ–≤—ã–≤–∞–µ–º—Å—è
  login to "ODU3ODc1ODMxMjQ5NDM2Njky.YNV9IA.k96H3lc3NVBbABmWRaqANE-B5DU" with name "AuthBot"

  # –ò–∑–º–µ–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å
  set online status of bot "AuthBot" to online
  set presence of bot named "AuthBot" to watching "–∑–∞ –∏–≥—Ä–æ–∫–∞–º–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"

on unload:
  shutdown the bot named "AuthBot"

# –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è 

discord command code [<text>]:
  prefixes: !
  executable in: guild
  trigger:
    if argument 1 is not set:
      make embed:
        set color of embed to red
        set description of embed to "üö® –í–∞–º –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –∫–æ–º–∞–Ω–¥—É."
        set footer of embed to "–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ"
        set timestamp of embed to now

      reply with last embed
      stop
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥
    set {_code} to argument 1
    
    set {_player} to {data::discord::%{_code}%::player}
    {_player} is set:
      # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Å–≤—è–∑—å –º–µ–∂–¥—É –∞–∫–∫–∞—É–Ω—Ç–æ–º –≤ –¥—Å
      # –∏ –∏–≥—Ä–æ–∫–æ–º –≤ –º–∞–π–Ω–µ.
      set {_discordId} to getPlayerDiscordId({_player})
      if {_discordId} is set:
        make embed:
          set color of embed to red
          set description of embed to "üö® –î–∞–Ω–Ω—ã–π –º–∞–π–Ω–∫—Ä–∞—Ñ—Ç-–∞–∫–∫–∞—É–Ω—Ç —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –¥–∏—Å–∫–æ—Ä–¥ –∞–∫–∫–∞—É–Ω—Ç—É"
          set footer of embed to "–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ"
          set timestamp of embed to now

        reply with last embed
        stop
      else:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º - –∑–∞–≥—Ä—É–∂–µ–Ω –ª–∏ —Ñ–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–≥—Ä–æ–∫–∞
        if yaml "player-%{_player}'s uuid%" is loaded:
          # –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —ç—Ç–æ—Ç –¥–∏—Å–∫–æ—Ä–¥-–∞–∫–∫–∞—É–Ω—Ç –∫ —ç—Ç–æ–º—É –∞–∫–∫–∞—É–Ω—Ç—É –≤ –º–∞–π–Ω–∫—Ä–∞—Ñ—Ç–µ
          setPlayerDiscordId({_player}, discord id of event-member)
          set {data::discord::%{_code}%::authorized} to true

          make embed:
            set title of embed to "üëç –ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω"
            set color of embed to green
            set description of embed to "–£—Ä–∞-—É—Ä–∞-—É—Ä–∞! –í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–ª–∏ –≤–∞—à –¥–∏—Å–∫–æ—Ä–¥-–∞–∫–∫–∞—É–Ω—Ç –∫ –º–∞–π–Ω–∫–∞—Ä—Ñ—Ç-–∞–∫–∫–∞—É–Ω—Ç—É! –¢–µ–ø–µ—Ä—å –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º –≤—Å–µ—Ö –Ω–∞—à–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤, –≤–µ—Å—å –≤–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –Ω–∞ –Ω–∞—à–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö –Ω—É –∏ –º–Ω–æ–≥–æ–µ-–º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ!\n\n–ö—Ä—É—Ç–æ –∫–æ—Ä–æ—á–µ, –¥–∞?"
            set footer of embed to "–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –ø—Ä–∏–≤—è–∑–∫–µ –∞–∫–∫–∞—É–Ω—Ç–µ"
            set timestamp of embed to now

          reply with last embed
        else:
          make embed:
            set color of embed to red
            set description of embed to "üö® –î–∞–Ω–Ω—ã–π –∏–≥—Ä–æ–∫ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–π–¥–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä `(–ü–∞—Ä–∞–¥–∞–π—Å)` –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑."
            set footer of embed to "–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ"
            set timestamp of embed to now

          reply with last embed
          stop
    else:
      make embed:
        set color of embed to red
        set description of embed to "üö® –î–∞–Ω–Ω—ã–π –∫–æ–¥ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑."
        set footer of embed to "–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ"
        set timestamp of embed to now

      reply with last embed
      stop

on button click:
  set {_id} to discord id of event-button

  {_id} contains "discordAuth":
    set {_temp::*} to {_id} split at "-"  
    set {_code} to {_temp::2}
    
    # –°—Ç–∞–≤–∏–º —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –∑–Ω–∞—á–µ–Ω–∏–µ "–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ"
    set {data::discord::authorization::%{_code}%::approved} to true
    
    # –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    set {_userId} to {data::discord::authorization::%{_code}%::discordId}
    set {data::discord::authorization::%{_code}%::messageDeleted} to true

    set {_user} to user with id "%{_userId}%"

    make embed:
      set title of embed to "üîì –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–∞"
      set footer of embed to "–ö–æ–¥ —Å–µ—Å—Å–∏–∏: %{_code}%"
      set timestamp of embed to now

    send last embed to user {_user}

# –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä–æ–∫—É
function sendAuthorizationRequest(player: player, code: string):
  set {_discordId} to yaml value "authorization.discordId" from "player-%{_player}'s uuid%"

  # –ë–µ—Ä—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  set {_user} to user with id "%{_discordId}%"

  # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
  set {_row} to new buttons row
  set {_approve} to new button with id "discordAuth-%{_code}%" styled success with content "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å" with emoji "üëå"
  set {_cancel} to new button with id "discordAuth-cancel" styled danger with content "–û—Ç–º–µ–Ω–∏—Ç—å" with emoji "‚úã"

  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
  set {data::discord::authorization::%{_code}%::discordId} to {_discordId}

  add {_approve} to row {_row}
  add {_cancel} to row {_row}

  make embed:
    set title of embed to "üîê –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é"
    set description of embed to "–ú—ã –ø–æ–ª—É—á–∏–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –í–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ –º–∞–π–Ω–∫—Ä–∞—Ñ—Ç (`%{_player}%`). –ï—Å–ª–∏ —ç—Ç–æ –í—ã —Ö–æ—Ç–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è - —Ç–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É —Å–Ω–∏–∑—É! –í –∏–Ω–æ–º –∂–µ —Å–ª—É—á–∞–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"
    set footer of embed to "–ö–æ–¥ —Å–µ—Å—Å–∏–∏: %{_code}%"
    set timestamp of embed to now

  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º
  send last embed to user {_user} and store it in {_message}
  set {data::discord::authorization::%{_code}%::messageDeleted} to false

  add row {_row} to message {_message}

  set {_time} to 120
  set {_waiting} to true

  while {_waiting} is true:
    if {data::discord::authorization::%{_code}%::messageDeleted} is not false:
      delete discord entity {_message}
      stop

    remove 0.05 from {_time}
    if {_time} <= 0:
      delete discord entity {_message}
      stop
    wait 1 tick

on unload:
  delete {data::discord::*}